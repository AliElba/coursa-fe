<div class="app-container">

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Unlock Your Potential with AI-Powered Learning</h1>
      <p class="hero-subtitle">
        Explore a curated collection of courses and exams designed to enhance your skills and prepare you for the future.
        Our platform leverages AI to personalize your learning journey and provide insightful feedback.
      </p>
      <button mat-flat-button color="primary" class="explore-btn" (click)="scrollToCourses()">
        Explore Courses
      </button>
    </div>
  </section>

  <!-- Courses Section -->
  <div class="section" #coursesSection>
    <h2 class="section-title">Available Courses</h2>
    
    <ng-container *ngIf="isLoading(); else notLoading">
      <!-- Shared Skeleton Loader: always shown immediately when loading -->
      <app-skeleton-loader [count]="skeletonCount"></app-skeleton-loader>
    </ng-container>
    <ng-template #notLoading>
      <ng-container *ngIf="error(); else noError">
        <!-- Error State -->
        <div class="error-container">
          <mat-icon class="error-icon">error</mat-icon>
          <p class="error-message">{{ error() }}</p>
          <button mat-flat-button color="primary" (click)="loadCourses()">
            Try Again
          </button>
        </div>
      </ng-container>
      <ng-template #noError>
        <ng-container *ngIf="!isLoading() && courses().length === 0; else showCourses">
          <!-- Empty State: Only show if backend returns empty array and not loading -->
          <div class="empty-container">
            <mat-icon class="empty-icon">school</mat-icon>
            <p>No courses available at the moment.</p>
            <p>Please check back later!</p>
          </div>
        </ng-container>
        <ng-template #showCourses>
          <!-- Courses Grid -->
          <div class="card-grid">
            <mat-card class="content-card" *ngFor="let course of courses(); trackBy: trackByCourseId">
              <img 
                [src]="course.image" 
                [alt]="course.title"
                class="card-image"
                loading="lazy"
                (error)="onImageError($event)">
              <mat-card-content class="card-content-flex">
                <h3 class="card-title">{{ course.title }}</h3>
                <div class="card-meta">
                  <span class="meta-item">
                    <mat-icon class="meta-icon">schedule</mat-icon>
                    {{ course.hours }} hours
                  </span>
                  <span class="meta-item">
                    <mat-icon class="meta-icon">quiz</mat-icon>
                    {{ course.numberOfExams }} exams
                  </span>
                </div>
                <p class="card-description">{{ course.description }}</p>
                <ng-container *ngIf="userCourses() && (course.id | function:coursesService.isUserRegisteredForCourse.bind(coursesService))">
                  <!-- Registration Status -->
                  <div class="registration-status">
                    <mat-icon class="status-icon">check_circle</mat-icon>
                    <span class="status-text">Registered ({{ course.id | function:coursesService.getRegistrationStatus.bind(coursesService) }})</span>
                  </div>
                </ng-container>
                <!-- Price and Register Button -->
                <div class="price-action-container">
                  <div class="price-label">
                    <span class="price">Price: ${{ course.price }}</span>
                  </div>
                  <button 
                    mat-stroked-button 
                    color="primary" 
                    class="register-btn" 
                    (click)="registerCourse(course)"
                    [disabled]="isLoading()">
                    {{ isLoading() ? 'Registering...' : 'Register' }}
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </ng-template>
      </ng-template>
    </ng-template>
  </div>

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="cta-content">
      <h2 class="cta-title">Ready to Start Your Learning Journey?</h2>
      <button mat-flat-button color="primary" class="cta-button" (click)="scrollToCourses()">
        Get Started Today
      </button>
    </div>
  </section>
</div>
